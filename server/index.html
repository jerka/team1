<html>
  <head>
    <style type="text/css">
      ul {
        padding: 0;
      }

      li {
        list-style-type: none;
        display: table-cell;
        border: 1px solid #ccc;
        width: 100px;
        height: 100px;
      }

      td {
        border: 1px solid #ccc;
        width: 100px;
        height: 100px;
      }
    </style>

    <script type="text/javascript" src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>

    <script src="/socket.io/socket.io.js"></script>

    <script src="grid.js"></script>

    <script type="text/javascript">
      var Game = {
        Socket: null,
        World: null,

        Init: function () {
          console.log('init');

          this.Socket = io.connect('http://localhost:8080');

          this.World = [['Blank','Blank','Blank'],
                        ['Blank','Blank','Blank']];

          this.Update();
        },

        SetupEvents: function () {
          $('#elements li').draggable({ 
              scroll: true,
              cursor: 'move', 
              cursorAt: { top: 50, left: 50 },
              snap: '#grid td',
              revert: false,
              helper: 'clone'
          });

          $('#grid td.blank').droppable({
            drop: function(event, ui) {
              var cell = $(this);

              var y = cell.index();
              var x = cell.parents('tr').index();
              var type = ui.draggable.attr('data-type');

              cell.text(ui.draggable.text());

              Game.SendDraw(x, y, type);
            }
          });
        },

        SendDraw: function (x, y, type) {
          console.log('sending draw, x: ' + x + ', y: ' + y + ', type: ' + type);

          this.World[x][y] = type;
          this.Socket.emit('draw', { x: x, y: y, type: type });

          this.Update();
        },

        Update: function () {
          Grid.Render(this.World);
          this.SetupEvents();
        }
      };

      $(function() {
        Game.Init();
      });
    </script>
  </head>
  <body>
    <ul id="elements">
      <li data-type="water">Water</li>
      <li data-type="stone">Stone</li>
    </ul>

    <div id="grid">
      <table>
        <tbody></tbody>
      </table>
    </div>
  </body>
</html>